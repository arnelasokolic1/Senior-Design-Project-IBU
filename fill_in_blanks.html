<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fill in the Blanks</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* Navbar */
    .navbar {
      background: linear-gradient(to left, #181A2F, #242E49, #37415C);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      padding: 0.8rem 2rem;
    }

    .navbar .navbar-brand,
    .navbar .nav-link {
      color: #fff !important;
      font-size: 18px;
      font-weight: 500;
      letter-spacing: 0.5px;
      transition: color 0.3s;
    }

    .navbar .nav-link:hover {
      color: #bb1f5d !important;
    }

    /* Sidebar / Levels */
    #levelSidebar {
      position: fixed;
      top: 70px;
      left: 20px;
      width: 250px;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      padding: 25px;
      z-index: 900;
      transition: transform 0.3s ease;
    }
    #levelSidebar h4 {
      text-align: center;
      font-weight: bold;
      margin-bottom: 20px;
      color: #242E49;
      font-size: 22px;
    }
    #levelSidebar .list-group-item {
      cursor: pointer;
      border: none;
      margin-bottom: 12px;
      padding: 12px;
      font-weight: 500;
      color: #242E49;
      background: linear-gradient(90deg, #f4f4f9, #fff);
      border-radius: 12px;
      transition: all 0.3s ease;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #levelSidebar .list-group-item:hover {
      background: linear-gradient(90deg, #bb1f5d, #e08e0a);
      color: #fff;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    #levelSidebar .btn-finish {
      margin-top: 15px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 16px;
      padding: 10px;
    }

    /* Body */
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f9;
      padding-top: 80px; 
      margin-left: 300px; 
    }

    .container {
      background: #fff;
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-width: 720px;
    }

    h1 { text-align: center; margin-bottom: 20px; font-weight: bold; }

    .question { margin-bottom: 18px; font-size: 18px; }
    input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
    .correct { background: #d4edda !important; }
    .incorrect { background: #f8d7da !important; }

    .btn-finish {
      display: block;
      width: 100%;
      margin-top: 20px;
      background: linear-gradient(to right, #bb1f5d, #e08e0a);
      border: none; color: white; font-weight: bold;
      border-radius: 10px; padding: 12px;
      transition: all 0.3s ease;
    }
    .btn-finish:hover { transform: scale(1.05); background: linear-gradient(to right, #9b154a, #c97a08); }

    /* Floating Statistics Panel */
    #statisticsPanel {
      position: fixed;
      top: 80px;
      right: 20px;
      width: 260px;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      padding: 20px;
      z-index: 1000;
      display: none;
    }
    #statisticsPanel h4 {
      text-align: center;
      font-weight: bold;
      color: #242E49;
      margin-bottom: 15px;
      font-size: 20px;
    }
    .progress { height: 20px; border-radius: 10px; overflow: hidden; margin-bottom: 10px; }
    .progress-bar { font-size: 12px; font-weight: bold; }

    /* Mascot */
    .mascot {
      width: 80px; height: 80px; cursor: pointer;
      position: fixed; right: 40px; top: 50%; transform: translateY(-50%);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      transition: transform 0.3s;
      z-index: 900;
      border-radius: 0; /* remove circle */
    }
    .mascot:hover { transform: translateY(-50%) scale(1.1); }

    /* Fact Popup */
    .fact {
      position: fixed; right: 140px; top: 50%; transform: translateY(-50%);
      background: #fff8e1; padding: 15px; border-radius: 12px;
      border-left: 6px solid #ffcc00; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      max-width: 260px; display: none; font-size: 15px;
      animation: fadeIn 0.5s ease; z-index: 999;
    }
    @keyframes fadeIn { from {opacity:0; transform:translateY(-50%) translateX(20px);} to {opacity:1; transform:translateY(-50%) translateX(0);} }

    @media (max-width: 992px) {
      body { margin-left: 0; padding-top: 140px; }
      #levelSidebar { position: relative; width: 100%; margin-bottom: 20px; }
      #statisticsPanel { right: 20px; top: auto; bottom: 20px; width: 95%; }
      .mascot { right: 20px; top: auto; bottom: 100px; }
      .fact { right: 20px; bottom: 180px; top: auto; }
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="home_page.html">Quiz App</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="home_page.html">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="about.html">About the Quiz</a></li>
          <li class="nav-item"><a class="nav-link" href="faq.html">FAQ</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Contact Us</a></li>
          <li class="nav-item"><a class="nav-link" href="fill_in_blanks.html">Fill In The Blanks</a></li>
          <li class="nav-item"><a class="nav-link" href="learn_with_us.html">Learn with Us</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Sidebar / Levels -->
  <div id="levelSidebar">
    <h4>Select Level</h4>
    <ul class="list-group">
      <li class="list-group-item" onclick="loadLevel(1)">Level 1: Easy</li>
      <li class="list-group-item" onclick="loadLevel(2)">Level 2: Medium</li>
      <li class="list-group-item" onclick="loadLevel(3)">Level 3: Hard</li>
      <li class="list-group-item" onclick="loadLevel(4)">Level 4: Very Hard</li>
      <li class="list-group-item" onclick="loadLevel(5)">Level 5: Expert</li>
    </ul>
    <button class="btn-finish" onclick="toggleStatisticsPanel()">Show Statistics</button>
  </div>

  <!-- Floating Statistics -->
  <div id="statisticsPanel">
    <h4>Your Statistics</h4>
    <p id="totalAnswered">Total Questions Answered: 0</p>
    <div class="progress">
      <div id="correctBar" class="progress-bar bg-success" style="width:0%">0% Correct</div>
    </div>
    <div class="progress">
      <div id="wrongBar" class="progress-bar bg-danger" style="width:0%">0% Wrong</div>
    </div>
  </div>

  <!-- Quiz -->
  <div class="container" id="quizContainer">
    <h1>Fill in the Blanks</h1>
    <div class="explanation" id="explanation"><p>Please select a level from the left sidebar to start the quiz.</p></div>
    <form id="quizForm">
      <div id="questionContainer"></div>
      <button type="button" class="btn-finish" id="finishButton" onclick="submitQuiz()" style="display:none">Finish</button>
    </form>
    <p style="color:red;text-align:center;margin-top:20px">* Leaving a field blank counts as incorrect</p>
  </div>

  <!-- Mascot -->
  <img src="imgs/Maskota.png" class="mascot" id="mascot" onclick="showFact()" alt="Mascot">
  <div class="fact" id="factBox">Loading blockchain fact...</div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.6.1/web3.min.js"></script>
  <script>
    const questionsByLevel = {
      1: [
        { question: "The technology behind Bitcoin is called", answer: "blockchain" },
        { question: "Bitcoin is a type of", answer: "cryptocurrency" },
        { question: "The first cryptocurrency was", answer: "bitcoin" },
        { question: "Ethereum is a decentralized", answer: "platform" }
      ],
      2: [
        { question: "A smart contract is a self-executing contract with the terms in", answer: "code" },
        { question: "Ethereum 2.0 uses this consensus algorithm", answer: "proof of stake" },
        { question: "What is the name of Ethereum's virtual machine?", answer: "jvm" },
        { question: "What is a ledger in blockchain?", answer: "record" }
      ],
      3: [
        { question: "Blockchain data is secured using", answer: "cryptography" },
        { question: "A transaction is verified by a network of", answer: "miners" },
        { question: "In blockchain, P2P stands for", answer: "peer to peer" },
        { question: "The process of verifying transactions is called", answer: "mining" }
      ],
      4: [
        { question: "Bitcoin is based on the principle of", answer: "decentralization" },
        { question: "The process of splitting a blockchain is called a", answer: "fork" },
        { question: "DeFi apps allow lending and", answer: "borrowing" }
      ],
      5: [
        { question: "This term refers to blockchain's inability to be altered", answer: "immutability" },
        { question: "Smart contracts are deployed mainly on", answer: "ethereum" }
      ]
    };

    let selectedLevel = null;
    let stats = JSON.parse(localStorage.getItem('quizStats')) || { totalAnswered:0, totalCorrect:0, totalWrong:0 };

    function loadLevel(level){
      selectedLevel = level;
      document.getElementById('explanation').style.display='none';
      document.getElementById('questionContainer').innerHTML='';
      document.getElementById('finishButton').style.display='block';
      let q = questionsByLevel[level];
      q.forEach((item,i)=>{
        document.getElementById('questionContainer').innerHTML += `
          <div class='question'>
            <label>${item.question}</label>
            <input type='text' id='answer-${i}' />
          </div>`;
      });
    }

    function submitQuiz(){
      let q = questionsByLevel[selectedLevel];
      let correct=0, wrong=0;
      q.forEach((item,i)=>{
        let user = document.getElementById(`answer-${i}`).value.toLowerCase().trim();
        if(user===item.answer.toLowerCase()){
          document.getElementById(`answer-${i}`).classList.add('correct'); correct++;
        } else { document.getElementById(`answer-${i}`).classList.add('incorrect'); wrong++; }
      });
      stats.totalAnswered += q.length; stats.totalCorrect += correct; stats.totalWrong += wrong;
      localStorage.setItem('quizStats', JSON.stringify(stats));
      updateStatsUI();
    }

    function toggleStatisticsPanel(){
      const panel = document.getElementById('statisticsPanel');
      panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
      updateStatsUI();
    }

    function updateStatsUI(){
      let answered=stats.totalAnswered, correct=stats.totalCorrect, wrong=stats.totalWrong;
      document.getElementById('totalAnswered').textContent=`Total Questions Answered: ${answered}`;
      let correctPct = answered? Math.round((correct/answered)*100):0;
      let wrongPct = answered? Math.round((wrong/answered)*100):0;
      document.getElementById('correctBar').style.width=correctPct+'%';
      document.getElementById('correctBar').textContent=correctPct+'% Correct';
      document.getElementById('wrongBar').style.width=wrongPct+'%';
      document.getElementById('wrongBar').textContent=wrongPct+'% Wrong';
    }

    const contractABI=[{"inputs":[{"internalType":"uint256","name":"seed","type":"uint256"}],"name":"getRandomFact","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}];
    const contractAddress="0x3F98F9459501c4709781b7d93c53De60Fb86C3B6";

    let web3, contract;
    if(window.ethereum){
      web3=new Web3(window.ethereum);
      window.ethereum.enable();
      contract=new web3.eth.Contract(contractABI, contractAddress);
    }

    let canClickMascot=true;
    async function getRandomFactFromContract(){
      try{
        const accounts=await web3.eth.getAccounts();
        const seed=Math.floor(Math.random()*1000);
        return await contract.methods.getRandomFact(seed).call({from:accounts[0]});
      }catch(err){ return "Failed to fetch fact, try again."; }
    }
    async function showFact(){
      if(!canClickMascot) return;
      canClickMascot=false;
      const fact=await getRandomFactFromContract();
      const box=document.getElementById("factBox");
      box.textContent=fact; box.style.display="block";
      setTimeout(()=>{ box.style.display="none"; canClickMascot=true; },5000);
    }

    updateStatsUI();
  </script>
</body>
</html>
